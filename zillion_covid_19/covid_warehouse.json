{
    "metrics": [
        {
            "name": "cases",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "deaths",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "hospitalized",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "in_icu",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "on_ventilator",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "recovered",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "negative_tests",
            "type": "Integer",
            "aggregation": "SUM"
        },        
        {
            "name": "test_results",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "hospital_beds",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "hospitals",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "icu_beds",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "population",
            "type": "Integer",
            "aggregation": "SUM"
        },

        {
            "name": "cumulative_cases",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_deaths",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_hospitalized",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_in_icu",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_recovered",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_on_ventilator",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_negative_tests",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_test_results",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "cumulative_pending_tests",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "currently_hospitalized",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "currently_in_icu",
            "type": "Integer",
            "aggregation": "SUM"
        },
        {
            "name": "currently_on_ventilator",
            "type": "Integer",
            "aggregation": "SUM"
        },        

        {
            "name": "death_rate",            
            "aggregation": "MEAN",
            "rounding": 3,
            "formula": "1.0*{deaths}/{cases}"
        },
        {
            "name": "hospitalized_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{hospitalized}/{cases}"
        },
        {
            "name": "hospitalized_death_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{deaths}/{hospitalized}"
        },
        {
            "name": "negative_test_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{negative_tests}/{test_results}"
        },
        {
            "name": "positive_test_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cases}/{test_results}"
        },

        {
            "name": "hospital_capacity_used",
            "aggregation": "MEAN",
            "rounding": 3,
            "formula": "1.0*{currently_hospitalized}/{hospital_beds}"
        },
        {
            "name": "icu_bed_capacity_used",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{currently_in_icu}/{icu_beds}"
        },
        
        {
            "name": "cumulative_recovered_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cumulative_recovered}/{cumulative_cases}"
        },
        {
            "name": "cumulative_ventilator_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cumulative_on_ventilator}/{cumulative_cases}"
        },        
        {
            "name": "cumulative_negative_test_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cumulative_negative_tests}/{cumulative_test_results}"
        },
        {
            "name": "cumulative_positive_test_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cumulative_cases}/{cumulative_test_results}"
        },
        {
            "name": "cumulative_cases_per_1M",            
            "aggregation": "MEAN",
            "rounding": 0,
            "formula": "1.0*{cumulative_cases}/({population}/1000000.0)"
        },
        {
            "name": "cumulative_deaths_per_1M",            
            "aggregation": "MEAN",
            "rounding": 0,
            "formula": "1.0*{cumulative_deaths}/({population}/1000000.0)"
        },
        {
            "name": "cumulative_icu_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cumulative_in_icu}/{cumulative_cases}"
        },
        {
            "name": "cumulative_death_rate",
            "aggregation": "MEAN",
            "rounding": 3,
            "formula": "1.0*{cumulative_deaths}/{cumulative_cases}"
        },
        {
            "name": "cumulative_hospitalized_rate",
            "aggregation": "MEAN",
            "rounding": 2,
            "formula": "1.0*{cumulative_hospitalized}/{cumulative_cases}"
        },

        {
            "name": "cases_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "deaths_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "hospitalized_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "in_icu_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "on_ventilator_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "recovered_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "test_results_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        },
        {
            "name": "negative_tests_cumsum",
            "type": "Integer",
            "aggregation": "SUM",
            "technical": "CUMSUM:ALL"
        }
    ],

    "dimensions": [
        {
            "name": "date",
            "type": "Date"
        },
        {
            "name": "iso1",
            "type": "String(3)"
        },
        {
            "name": "iso2",
            "type": "String(6)"
        },
        {
            "name": "fips",
            "type": "String(5)"
        },
        {
            "name": "iso1_name",
            "type": "String(50)"
        },
        {
            "name": "country",
            "type": "String(50)"
        },
        {
            "name": "iso2_name",
            "type": "String(50)"
        },
        {
            "name": "state",
            "type": "String(50)"
        },
        {
            "name": "fips",
            "type": "String(5)"
        },
        {
            "name": "us_county_name",
            "type": "String(50)"
        },
        {
            "name": "us_county_name_long",
            "type": "String(50)"
        },
        {
            "name": "us_county_code",
            "type": "String(5)"
        },
        {
            "name": "iso1_lat",
            "type": "Numeric(9,6)"
        },
        {
            "name": "iso1_long",
            "type": "Numeric(9,6)"
        },
        {
            "name": "iso1_timezone",
            "type": "String(30)"
        },
        {
            "name": "iso2_lat",
            "type": "Numeric(9,6)"
        },
        {
            "name": "iso2_long",
            "type": "Numeric(9,6)"
        },
        {
            "name": "iso2_timezone",
            "type": "String(30)"
        },
        {
            "name": "fips_lat",
            "type": "Numeric(9,6)"
        },
        {
            "name": "fips_long",
            "type": "Numeric(9,6)"
        },
        {
            "name": "fips_timezone",
            "type": "String(30)"
        }
    ],
    
    "datasources": {
        "glide_covid_19": {
            "url": "sqlite:///sqlite.db",
            "tables": {
                "main.iso1_geos": {
                    "type": "DIMENSION",
                    "primary_key": ["iso1"],
                    "columns": {
                        "iso1": {"fields":["iso1"]},
                        "name": {"fields":["iso1_name", "country"]},
                        "timezone": {"fields":["iso1_timezone"]},
                        "lat": {"fields":["iso1_lat"]},
                        "long": {"fields":["iso1_long"]}
                    }
                },

                "main.iso1_stats_view": {
                    "type": "METRIC",
                    "primary_key": ["iso1"],
                    "create_fields": true,
                    "use_full_column_names": false
                },

                "main.iso2_geos": {
                    "type": "DIMENSION",
                    "primary_key": ["iso2"],
                    "parent": "main.iso1_geos",
                    "columns": {
                        "iso2": {"fields":["iso2"]},
                        "iso1": {"fields":["iso1"]},
                        "name": {"fields":["iso2_name", "state"]},
                        "timezone": {"fields":["iso2_timezone"]},
                        "lat": {"fields":["iso2_lat"]},
                        "long": {"fields":["iso2_long"]}
                    }
                },

                "main.iso2_stats_view": {
                    "type": "METRIC",
                    "primary_key": ["iso2"],
                    "create_fields": true,
                    "use_full_column_names": false
                },

                "main.fips": {
                    "type": "DIMENSION",
                    "primary_key": ["fips"],
                    "parent": "main.iso2_geos",
                    "columns": {
                        "fips": {"fields":["fips"]},
                        "county_code": {"fields":["us_county_code"]},
                        "name": {"fields":["us_county_name"]},
                        "name_long": {"fields":["us_county_name_long"]},
                        "timezone": {"fields":["fips_timezone"]},
                        "lat": {"fields":["fips_lat"]},
                        "long": {"fields":["fips_long"]},
                        "state_code_iso": {"fields": ["iso2"]}
                    }
                },

                "main.fips_stats_view": {
                    "type": "METRIC",
                    "primary_key": ["fips"],
                    "create_fields": true,
                    "use_full_column_names": false
                },               
                
                "main.iso2_healthcare_capacity": {
                    "type": "METRIC",
                    "primary_key": ["iso2"],
                    "create_fields": true,
                    "use_full_column_names": false
                },

                "main.fips_icu_beds": {
                    "type": "METRIC",
                    "primary_key": ["fips"],
                    "create_fields": true,
                    "use_full_column_names": false
                },
               
                "main.fips_timeseries_view": {
                    "type": "METRIC",
                    "primary_key": ["date", "fips"],
                    "create_fields": true,
                    "use_full_column_names": false,
                    "columns": {
                        "date": {"fields": ["date"], "allow_type_conversions": true},
                        "cases": {"fields": ["cases", "cases_cumsum"]},
                        "deaths": {"fields": ["deaths", "deaths_cumsum"]},
                        "cumulative_cases": {"required_grain": ["date"]},
                        "cumulative_deaths": {"required_grain": ["date"]},
                        "hospitals": {"required_grain": ["date"]},
                        "icu_beds": {"required_grain": ["date"]}
                    }
                },

                "main.iso2_timeseries_view": {
                    "type": "METRIC",
                    "primary_key": ["date", "iso1", "iso2"],
                    "incomplete_dimensions": ["iso2"],
                    "use_full_column_names": false,
                    "columns": {
                        "date": {"fields": ["date"], "allow_type_conversions": true},
                        "iso1": {"fields": ["iso1"]},
                        "iso2": {"fields": ["iso2"]},
                        "cases": {"fields": ["cases", "cases_cumsum"]},
                        "deaths": {"fields": ["deaths", "deaths_cumsum"]},
                        "hospitalized": {"fields": ["hospitalized", "hospitalized_cumsum"]},
                        "in_icu": {"fields": ["in_icu", "in_icu_cumsum"]},
                        "on_ventilator": {"fields": ["on_ventilator", "on_ventilator_cumsum"]},
                        "recovered": {"fields": ["recovered", "recovered_cumsum"]},
                        "test_results": {"fields": ["test_results", "test_results_cumsum"]},
                        "negative_tests": {"fields": ["negative_tests", "negative_tests_cumsum"]},                        
                        "cumulative_cases": {"required_grain": ["date"]},
                        "cumulative_deaths": {"required_grain": ["date"]},
                        "cumulative_negative_tests": {"required_grain": ["date"]},
                        "cumulative_pending_tests": {"required_grain": ["date"]},
                        "cumulative_hospitalized": {"required_grain": ["date"]},
                        "cumulative_in_icu": {"required_grain": ["date"]},
                        "cumulative_on_ventilator": {"required_grain": ["date"]},
                        "cumulative_test_results": {"required_grain": ["date"]},
                        "cumulative_recovered": {"required_grain": ["date"]},
                        "currently_hospitalized": {"required_grain": ["date"]},
                        "currently_in_icu": {"required_grain": ["date"]},
                        "currently_on_ventilator": {"required_grain": ["date"]},
                        "hospital_beds": {"required_grain": ["date"]},
                        "total_chcs": {"required_grain": ["date"]},
                        "chc_service_delivery_sites": {"required_grain": ["date"]},
                        "iso2_name": {"fields": ["iso2_name", "state"]}
                    }
                }
            }
        }
    }
}
